<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ page.title }} | archive-wonjy</title>
  <style>
    :root { --blue:#007BFF; --border:#ddd; --text:#222; --muted:#666; }
    html, body { margin:0; padding:0; font-family:sans-serif; color:var(--text); line-height:1.6; }

    /* Header / Nav */
    header.site { display:flex; align-items:center; gap:40px; padding:20px 24px; border-bottom:1px solid var(--border); }
    .title { font-size:1.2em; font-weight:600; text-transform: lowercase; }
    nav a { margin-left:24px; text-decoration:none; color:#555; font-size:0.95em; transition: color .2s; }
    nav a:hover, nav a.active, nav a[aria-current="page"] { color: var(--blue); }

    /* Main container – left aligned */
    main { max-width: 1200px; margin: 0; padding: 50px 40px 60px 24px; }

    /* Intro (cover + meta) */
    .intro { display:flex; gap:40px; align-items:flex-start; margin-bottom:40px; }
    .intro-image { flex-basis:70%; min-width:0; }
    .intro-image figure { margin:0; }
    .intro-image img { width:100%; height:auto; display:block; }
    .intro-image .caption { font-size:0.8em; color:var(--muted); margin-top:3px; margin-bottom:40px; }

    .intro-side { flex:1; min-width:0; font-size:0.95em; color:#333; }
    .intro-group { max-width:100%; }
    .intro-header h1 { font-size: clamp(1.4em, 2vw, 1.6em); font-style: italic; font-weight:600; margin:0 0 4px 0; }
    .intro-header .year { font-size:1.05em; font-weight:500; color:#777; margin-bottom:16px; }
    .meta-row { margin:0 0 4px 0; }
    .meta-row .label { color:#777; margin-right:6px; }
    .meta-row .value { color:#333; }

    .divider { border:none; border-top:1px solid var(--border); margin:30px 0; }

    /* Rich text blocks */
    .rich p { margin:0 0 1em 0; }
    .rich a { color: var(--blue); text-decoration:none; }
    .rich a:hover, .rich a:focus { text-decoration: underline; }
    .section-title { margin:0 0 8px 0; font-size:1em; color:#555; }

    /* Work images */
    figure.work { margin:0; }
    img.work { width:100%; height:auto; display:block; margin-bottom:3px; }
    .caption { font-size:0.8em; color: var(--muted); margin-bottom:40px; }

    /* Video (responsive 16:9) */
    figure.video { width:100%; margin:0; }

    /* 플레이어 프레임: 가로 100%, 세로는 16:9 (높이 자동) */
    .video .frame{
      position:relative;
      width:100%;
      aspect-ratio:16/9;     /* 지원 브라우저: 이 값 사용 */
      margin-bottom:3px;
      box-sizing:border-box;
    }
    
    .video .frame iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      display:block;
      border:0;
    }
    
    /* aspect-ratio 미지원 브라우저 폴백 */
    @supports not (aspect-ratio:1){
      .video .frame{ padding-top:56.25%; } /* 16:9 */
      .video .frame iframe{ height:100%; }
    }
    
    /* 캡션은 이미지와 동일 */
    .video .caption{ font-size:0.8em; color:var(--muted); margin-bottom:40px; }
    
    /* Related texts */
    .related-texts { list-style:none; margin:8px 0 0; padding:0; }
    .related-texts li { margin:0 0 6px 0; position:relative; padding-left:14px; }
    .related-texts li::before { content:"–"; position:absolute; left:0; color:var(--muted); }
    .related-texts a { color: var(--blue); text-decoration:none; margin-left:6px; }
    .related-texts a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      main { padding:40px 20px 50px 24px; }
      .intro { flex-direction: column; gap:24px; }
      .intro-image, .intro-side, .intro-group { flex:none; width:100%; max-width:100%; }
    }

    /* Bottom floating bar */
    #btBar { position: fixed; right: 24px; bottom: 20px; z-index: 999; display: none; font-size: 0.95em; background: transparent; gap:16px; }
    #btBar .copy { color: #888; }
    #btBar a#backToTop { color: var(--blue); text-decoration: none; }
    #btBar a#backToTop:hover { text-decoration: underline; }
    #btBar a#backToTop:focus-visible { outline:2px solid var(--blue); outline-offset:2px; }

    /* 강제 통일: 비디오는 이미지와 동일 폭(컨테이너 100%) */
.intro-image figure.video{ width:100% !important; margin:0; }
.intro-image figure.video .frame{ width:100% !important; position:relative; aspect-ratio:16/9; margin-bottom:3px; }
.intro-image figure.video .frame iframe{
  position:absolute; inset:0;
  width:100% !important; height:100% !important;
  max-width:none !important; display:block; border:0;
}
/* aspect-ratio 미지원 폴백 */
@supports not (aspect-ratio:1){
  .intro-image figure.video .frame{ padding-top:56.25%; }
}
    
  </style>
</head>
<body>
  <header class="site">
    <div class="title">archive-wonjy.com</div>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/work.html" class="active" aria-current="page">Work</a>
      <a href="/bio.html">Bio</a>
      <a href="/texts.html">Texts</a>
      <a href="/contact.html">Contact</a>
    </nav>
  </header>

  <main>
    {%- assign s = page.year_start -%}
    {%- assign e = page.year_end -%}
    {%- if e -%}
      {%- if s == e -%}
        {%- assign year_display = s -%}
      {%- else -%}
        {%- assign year_display = s | append: " – " | append: e -%}
      {%- endif -%}
    {%- else -%}
      {%- assign year_display = s | append: " –" -%}
    {%- endif -%}

    <section class="intro">
      <div class="intro-image">
        {%- if page.cover -%}
          <figure class="cover">
            <img src="{{ page.cover | relative_url }}" alt="{{ page.title }} cover" loading="lazy" decoding="async"
              {%- if page.cover_width and page.cover_height -%} width="{{page.cover_width}}" height="{{page.cover_height}}" {%- endif -%}
              sizes="(max-width:768px) 100vw, 70vw" />
            {%- if page.cover_caption -%}
              <figcaption class="caption">{{ page.cover_caption }}</figcaption>
            {%- else -%}
              <figcaption class="caption"><em>{{ page.title }}</em></figcaption>
            {%- endif -%}
          </figure>
        {%- endif -%}

        {%- if page.images -%}
          {%- for img in page.images -%}
            <figure class="work">
              <img src="{{ img.src | relative_url }}" alt="{{ img.alt | default: '' }}" class="work" loading="lazy" decoding="async"
                {%- if img.width and img.height -%} width="{{img.width}}" height="{{img.height}}" {%- endif -%} />
              {%- if img.caption -%}
                <figcaption class="caption">{{ img.caption }}</figcaption>
              {%- endif -%}
            </figure>
          {%- endfor -%}
        {%- endif -%}

          {%- if page.videos -%}
    {%- for v in page.videos -%}
      <figure class="video">
  <div class="frame">
    <iframe src="{{ v.src }}" allow="autoplay; fullscreen; picture-in-picture" loading="lazy" allowfullscreen></iframe>
  </div>
  {% if v.caption %}<figcaption class="caption">{{ v.caption }}</figcaption>{% endif %}
</figure>
    {%- endfor -%}
  {%- endif -%}
        
      </div>

      <aside class="intro-side">
        <div class="intro-group">
          <div class="intro-header">
            <h1>{{ page.title }}</h1>
            {%- if s -%}<div class="year">{{ year_display }}</div>{%- endif -%}

            {%- if page.types and page.types.size > 0 -%}
              <p class="meta-row"><span class="label">Type</span>
                <span class="value">
                  {%- for t in page.types -%}
                    <span>{{ t }}{% unless forloop.last %}, {% endunless %}</span>
                  {%- endfor -%}
                </span>
              </p>
            {%- elsif page.type -%}
              <p class="meta-row"><span class="label">Type</span><span class="value">{{ page.type }}</span></p>
            {%- endif -%}

            {%- if page.status -%}
              <p class="meta-row"><span class="label">Status</span><span class="value">{{ page.status }}</span></p>
            {%- endif -%}

            {%- if page.tags and page.tags.size > 0 -%}
              <p class="meta-row"><span class="label">Tags</span>
                <span class="value">
                  {%- for t in page.tags -%}
                    <span>{{ t }}{% unless forloop.last %}, {% endunless %}</span>
                  {%- endfor -%}
                </span>
              </p>
            {%- endif -%}
          </div>

          {%- if page.summary -%}
            <div class="divider"></div>
            <div class="rich summary">{{ page.summary | markdownify }}</div>
          {%- endif -%}

          {%- if page.description -%}
            <div class="divider"></div>
            <div class="rich description">{{ page.description | markdownify }}</div>
          {%- endif -%}

{%- assign page_lang = page.lang | default: site.lang | default: 'en' | downcase -%}

{%- comment -%} Compute “has_related” safely {%- endcomment -%}
{%- assign has_related = false -%}
{%- assign valid_related = '' -%}
{%- if page.related_texts and page.related_texts.size > 0 -%}
  {%- assign valid_related = page.related_texts | where_exp: "item", "item.id != ''" -%}
  {%- if valid_related and valid_related.size > 0 -%}
    {%- assign has_related = true -%}
  {%- endif -%}
{%- elsif page.critique_links and page.critique_links.size > 0 -%}
  {%- assign has_related = true -%}
{%- elsif page.critique -%}
  {%- assign has_related = true -%}
{%- endif -%}

{%- if has_related -%}
  {%- if valid_related and valid_related.size > 0 -%}
    <div class="divider"></div>
    {%- if page.critique_title -%}
      <div class="section-title">{{ page.critique_title }}</div>
    {%- endif -%}
    <ul class="related-texts">
      {%- for r in valid_related -%}
        {%- assign t = site.data.texts[r.id] -%}
        {%- if t -%}
          {%- assign orig = t.original.language | default: 'fr' | downcase -%}
          {%- assign target = r.lang | default: page_lang -%}

          {%- assign has_tr = false -%}
          {%- for tr in t.translations -%}
            {%- if tr.language == target -%}{%- assign has_tr = true -%}{%- endif -%}
          {%- endfor -%}

          {%- assign orig = t.original.language | default: 'fr' | downcase -%}
{%- assign target = r.lang | default: page_lang | downcase -%}

{%- assign has_tr = false -%}
{%- for tr in t.translations -%}
  {%- if tr.language == target -%}{%- assign has_tr = true -%}{%- endif -%}
{%- endfor -%}

{%- if has_tr -%}
  {%- assign lang_final = target -%}
{%- else -%}
  {%- assign lang_final = orig -%}
{%- endif -%}
          {%- assign href = '/texts.html?id=' | append: r.id | append: '&lang=' | append: lang_final -%}

          {%- assign raw_label = r.label | default: '' -%}
          {%- assign cleaned = raw_label | strip | replace:'.','' | replace:'·','' | replace:'•','' -%}
          {%- if cleaned != '' -%}
            {%- assign label_html = raw_label -%}
          {%- else -%}
            {%- assign title_html = t.title_original.text_html -%}
            {%- assign author = t.author.name -%}
            {%- assign year = t.year -%}
            {%- assign label_html = '<em>' | append: title_html | append: '</em>, ' | append: author | append: ', ' | append: year -%}
          {%- endif -%}

          <li><a class="link-button" href="{{ href | relative_url }}">{{ label_html }}</a></li>
        {%- endif -%}
      {%- endfor -%}
    </ul>

  {%- elsif page.critique_links and page.critique_links.size > 0 -%}
    <div class="divider"></div>
    {%- if page.critique_title -%}
      <div class="section-title">{{ page.critique_title }}</div>
    {%- endif -%}
    <ul class="related-texts">
      {%- for item in page.critique_links -%}
        <li>
          {{ item.label | markdownify | remove: '<p>' | remove: '</p>' }}
          {%- if item.url_fr -%} <a href="{{ item.url_fr }}" class="text-link">(FR)</a>{%- endif -%}
          {%- if item.url_en -%} <a href="{{ item.url_en }}" class="text-link">(EN)</a>{%- endif -%}
        </li>
      {%- endfor -%}
    </ul>

  {%- elsif page.critique -%}
    <div class="divider"></div>
    {%- if page.critique_title -%}
      <div class="section-title">{{ page.critique_title }}</div>
    {%- endif -%}
    <div class="rich critique">{{ page.critique | markdownify }}</div>
  {%- endif -%}
{%- endif -%}

        </div>
      </aside>
    </section>

    {%- if content and content != "" -%}
      <article class="rich">{{ content }}</article>
    {%- endif -%}
  </main>

  <div id="btBar" role="region" aria-label="Back to top bar">
    <span class="copy">© ADAGP, Paris, 2025</span>
    <a id="backToTop" href="#" aria-label="Back to top">Back to top</a>
  </div>

  <script>
    (function(){
      const bar=document.getElementById('btBar');
      const btn=document.getElementById('backToTop');
      const showAfter=300;
      window.addEventListener('scroll',()=>{bar.style.display=(window.scrollY>showAfter)?'flex':'none';});
      btn.addEventListener('click',(e)=>{e.preventDefault();
        const reduce=window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(reduce) window.scrollTo(0,0); else window.scrollTo({top:0,behavior:'smooth'});
      });
    })();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      document.querySelectorAll('.summary a, .description a, .related-texts a').forEach(function(link){
        link.setAttribute('target','_blank');
        link.setAttribute('rel','noopener noreferrer');
      });
    });
  </script>
</body>
</html>

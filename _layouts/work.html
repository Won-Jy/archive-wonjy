{%- if has_related -%}
  {%- if valid_related and valid_related.size > 0 -%}
    <div class="divider"></div>
    {%- if page.critique_title -%}
      <div class="section-title">{{ page.critique_title }}</div>
    {%- endif -%}

    <ul class="related-texts">
      {%- for r in valid_related -%}
        {%- assign t = site.data.texts[r.id] -%}
        {%- if t -%}
          {%- assign orig = t.original.language | default: 'fr' | downcase -%}
          {%- assign target = r.lang | default: page_lang -%}

          {%- assign has_tr = false -%}
          {%- for tr in t.translations -%}
            {%- if tr.language == target -%}{%- assign has_tr = true -%}{%- endif -%}
          {%- endfor -%}

          {%- assign lang_final = has_tr | default: false | ternary: target, orig -%}
          {%- assign href = '/texts.html?id=' | append: r.id | append: '&lang=' | append: lang_final -%}

          {%- assign raw_label = r.label | default: '' -%}
          {%- assign cleaned = raw_label | strip | replace:'.','' | replace:'·','' | replace:'•','' -%}
          {%- if cleaned != '' -%}
            {%- assign label_html = raw_label -%}
          {%- else -%}
            {%- assign title_html = t.title_original.text_html -%}
            {%- assign author = t.author.name -%}
            {%- assign year = t.year -%}
            {%- assign label_html = '<em>' | append: title_html | append: '</em>, ' | append: author | append: ', ' | append: year -%}
          {%- endif -%}

          <li><a class="link-button" href="{{ href | relative_url }}">{{ label_html }}</a></li>
        {%- endif -%}
      {%- endfor -%}
    </ul>

  {%- elsif page.critique_links and page.critique_links.size > 0 -%}
    <!-- (critique_links 분기 그대로 유지) -->
  {%- elsif page.critique -%}
    <!-- (critique 분기 그대로 유지) -->
  {%- endif -%}
{%- endif -%}

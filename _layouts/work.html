---
layout: none
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>{{ page.title | escape }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="{{ page.description | default: site.description | escape }}">
  <link rel="icon" href="/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}"/>

  <style>
    :root{
      --blue:#007BFF;
      --border:#ddd;
      --text:#222;
      --muted:#666;
      --bg:#fff;
      --lb-bg:rgba(0,0,0,.86);
    }

    html,body{ background:var(--bg); color:var(--text); }

    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 40px; border-bottom:1px solid var(--border);
    }
    header .title a{ text-decoration:none; color:inherit; }
    nav a{ margin-left:24px; text-decoration:none; color:#555; transition:color .2s; }
    nav a:hover,nav a.active{ color:var(--blue); }

    main{
      padding:60px 40px;
      max-width:1000px;
      margin:0 auto;
    }

    .intro-cover{ margin:20px 0 32px 0; }
    .intro-cover figure.cover{ margin:0; }
    .intro-cover figure.cover img{
      width:100%; height:auto; display:block; cursor:zoom-in;
    }
    .caption{ margin-top:8px; color:var(--muted); font-size:.95em; line-height:1.5; }

    .intro-media{
      display:grid; gap:24px;
      grid-template-columns:repeat(2, 1fr);
    }
    .intro-media figure.work{ margin:0; }
    .intro-media figure.work img.work{
      width:100%; height:auto; display:block; cursor:zoom-in;
    }
    .intro-media figure.work.video iframe{
      width:100%; aspect-ratio:16/9; display:block; border:0;
    }

    .meta{ margin:6px 0 28px 0; color:#555; }

    /* 라이트박스 오버레이 */
    .lb-overlay{
      position:fixed; inset:0; background:var(--lb-bg);
      display:none; z-index:9999;
    }
    .lb-overlay.open{ display:block; }
    .lb-stage{
      position:absolute; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center; padding:24px;
    }
    .lb-close{
      position:absolute; top:12px; right:16px; font-size:28px; line-height:1;
      width:40px; height:40px; border:0; background:transparent; color:#fff;
      cursor:pointer;
    }
    .lb-footer{
      display:flex; align-items:center; gap:16px; margin-top:10px; color:#eee;
      user-select:none;
    }
    .lb-ctrl{
      width:42px; height:42px; border-radius:10px; border:0; cursor:pointer;
      background:rgba(255,255,255,.1); color:#fff; font-size:22px;
      display:flex; align-items:center; justify-content:center;
    }
    .lb-ctrl:hover{ background:rgba(255,255,255,.2); }
    .lb-counter{ min-width:68px; text-align:center; }

    /* 듀얼 이미지 캔버스: 빠른 전환 */
    .lb-canvas{
      position:relative;
      width:min(92vw, 1600px);
      height:min(74vh, 1000px);
      background:#111; overflow:hidden;
      display:none;
    }
    .lb-img{
      position:absolute; inset:0;
      max-width:100%; max-height:100%;
      width:100%; height:100%;
      object-fit:contain;
      opacity:0;
      transition:opacity .18s linear;
      will-change:opacity;
      display:block;
    }
    .lb-img.show{ opacity:1; }

    .lb-video{ display:none; width:min(92vw, 1600px); }
    .lb-video iframe{
      width:100%; aspect-ratio:16/9; border:0; display:block;
    }

    .lb-caption{
      margin-top:10px; color:#ddd; max-width:min(92vw, 1600px);
      line-height:1.5; font-size:.95em;
    }

    /* 모바일 */
    @media (max-width: 768px){
      header{ flex-direction:column; align-items:flex-start; padding:16px 20px; }
      nav{ margin-top:10px; }
      nav a{ margin-left:30px; }
      nav a:first-child{ margin-left:0; }

      main{ padding:60px 24px; max-width:700px; }

      .intro-media{ grid-template-columns:1fr; gap:16px; }
    }
  </style>

  <!-- Vimeo Player SDK (필요 시 한 번만 로드) -->
  <script src="https://player.vimeo.com/api/player.js"></script>
</head>
<body>

  <header>
    <div class="title"><a href="{{ '/' | relative_url }}">archive-wonjy.com</a></div>
    <nav>
      <a href="{{ '/work.html' | relative_url }}">Work</a>
      <a href="{{ '/texts.html' | relative_url }}">Texts</a>
      <a href="{{ '/bio.html' | relative_url }}">Bio</a>
      <a href="{{ '/contact.html' | relative_url }}">Contact</a>
    </nav>
  </header>

  <main class="detail">
    <h1 class="text-title">{{ page.title }}</h1>
    <div class="meta">
      <span>
        {% if page.year %}{{ page.year }}{% endif %}
        {% if page.medium %} · {{ page.medium }}{% endif %}
        {% if page.dimensions %} · {{ page.dimensions }}{% endif %}
      </span>
    </div>

    <!-- 커버 이미지 -->
    {% if page.cover %}
    <section class="intro-cover">
      <figure class="cover">
        <img
          src="{{ page.cover.src | relative_url }}"
          alt="{{ page.cover.alt | default: page.title | escape }}"
          decoding="async"
          loading="eager"
          width="{{ page.cover.width | default: 2000 }}"
          height="{{ page.cover.height | default: 1333 }}"
        >
        {% if page.cover.caption %}
          <figcaption class="caption">{{ page.cover.caption }}</figcaption>
        {% endif %}
      </figure>
    </section>
    {% endif %}

    <!-- 미디어 그리드: 이미지 또는 비디오 iframe -->
    {% if page.media %}
    <section class="intro-media">
      {% for m in page.media %}
        {% if m.type == 'image' %}
          <figure class="work">
            <img class="work"
                 src="{{ m.src | relative_url }}"
                 alt="{{ m.alt | default: page.title | escape }}"
                 decoding="async"
                 loading="lazy"
                 width="{{ m.width | default: 1600 }}"
                 height="{{ m.height | default: 1067 }}">
            {% if m.caption %}<figcaption class="caption">{{ m.caption }}</figcaption>{% endif %}
          </figure>
        {% elsif m.type == 'video' %}
          <figure class="work video">
            <iframe
              src="{{ m.src }}"
              allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
              allowfullscreen
              playsinline
            ></iframe>
            {% if m.caption %}<figcaption class="caption">{{ m.caption }}</figcaption>{% endif %}
          </figure>
        {% endif %}
      {% endfor %}
    </section>
    {% endif %}

    <!-- 본문 텍스트가 있다면 -->
    {% if content %}
      <article class="work-body">
        {{ content }}
      </article>
    {% endif %}
  </main>

  <!-- 라이트박스: 듀얼 이미지 + 비디오 -->
  <div class="lb-overlay" id="lbOverlay" aria-modal="true" role="dialog" aria-label="Image viewer">
    <div class="lb-stage">
      <button class="lb-close" id="lbClose" aria-label="Close">×</button>

      <div class="lb-canvas" id="lbCanvas" aria-hidden="true">
        <img id="lbImgA" class="lb-img" alt="">
        <img id="lbImgB" class="lb-img" alt="">
      </div>

      <div id="lbVideo" class="lb-video" aria-hidden="true">
        <iframe id="lbIframe" src=""
                allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
                allowfullscreen
                playsinline
                tabindex="-1"></iframe>
      </div>

      <div class="lb-caption" id="lbCap"></div>

      <div class="lb-footer" aria-label="image navigation">
        <button class="lb-ctrl lb-prev" id="lbPrev" aria-label="Previous">‹</button>
        <div class="lb-counter" id="lbCount">0/0</div>
        <button class="lb-ctrl lb-next" id="lbNext" aria-label="Next">›</button>
      </div>
    </div>
  </div>

  <script>
  ;(function(){
    // 갤러리 수집: 커버 이미지, 그리드 이미지, 그리드 비디오
    const gallery=[];
    const nodes=document.querySelectorAll(
      '.intro-cover figure.cover img, '+
      '.intro-media figure.work img.work, '+
      '.intro-media figure.work.video iframe'
    );

    nodes.forEach((node)=>{
      const fig=node.closest('figure');
      const cap=fig?(fig.querySelector('.caption')?.innerHTML||''):'';
      const isVideo=node.tagName.toLowerCase()==='iframe';
      const src=node.getAttribute('src')||node.getAttribute('data-src')||'';
      const index=gallery.length;

      gallery.push({type:isVideo?'video':'image', el:node, src, caption:cap});

      if(!isVideo){
        node.style.cursor='zoom-in';
        node.addEventListener('click',(e)=>{ e.preventDefault(); openLB(index); });
      }else{
        // 비디오 썸네일 클릭도 라이트박스에서 보고 싶으면 아래 주석 해제
        // fig.style.cursor='zoom-in';
        // fig.addEventListener('click',(e)=>{ e.preventDefault(); openLB(index); });
      }
    });

    if(!gallery.length) return;

    // 라이트박스 요소
    const overlay=document.getElementById('lbOverlay');
    const lbCanvas=document.getElementById('lbCanvas');
    const imgA=document.getElementById('lbImgA');
    const imgB=document.getElementById('lbImgB');
    const lbVideo=document.getElementById('lbVideo');
    const lbIframe=document.getElementById('lbIframe');
    const lbCap=document.getElementById('lbCap');
    const lbPrev=document.getElementById('lbPrev');
    const lbNext=document.getElementById('lbNext');
    const lbClose=document.getElementById('lbClose');
    const lbCount=document.getElementById('lbCount');

    let idx=0, open=false;
    let lbPlayer=null;
    let active='A'; // A 또는 B 이미지가 현재 표시중인지
    let didPushState=false;

    function onPopStateCloseLB(){ if(open) closeLB(); }

    // Vimeo id 추출
    function vimeoIdFromUrl(u){
      const m=String(u||'').match(/vimeo\.com\/(?:video\/)?(\d+)/);
      return m?m[1]:null;
    }

    async function stopVideo(){
      try{ if(lbPlayer && typeof lbPlayer.unload==='function'){ await lbPlayer.unload(); } }catch(e){}
    }

    function setAriaFor(kind){
      if(kind==='image'){
        lbCanvas.setAttribute('aria-hidden','false');
        lbVideo.setAttribute('aria-hidden','true');
      }else{
        lbCanvas.setAttribute('aria-hidden','true');
        lbVideo.setAttribute('aria-hidden','false');
      }
    }
    function setVisible(el,show){ el.style.display = show ? 'block' : 'none'; }

    // 옆 이미지 프리로드(앞/뒤 한 장)
    function preloadNeighbors(center){
      [1,-1].forEach(step=>{
        const ni=(center+step+gallery.length)%gallery.length;
        const it=gallery[ni];
        if(it.type==='image' && it.src){
          const im=new Image();
          im.loading='eager';
          im.decoding='async';
          im.src=it.src;
          try{
            const link=document.createElement('link');
            link.rel='preload'; link.as='image'; link.href=it.src;
            document.head.appendChild(link);
            setTimeout(()=>link.remove(), 4000);
          }catch(e){}
        }
      });
    }

    // 듀얼 이미지 교차 페이드
    function swapImage(url, alt){
      const show=(active==='A')?imgB:imgA;
      const hide=(active==='A')?imgA:imgB;

      try{ show.fetchPriority='high'; }catch(e){}
      show.decoding='async';
      show.loading='eager';
      show.style.opacity=0;
      show.src=url;
      show.alt=alt||'';

      const reveal=()=>{
        requestAnimationFrame(()=>{
          hide.classList.remove('show');
          show.classList.add('show');
          show.style.opacity=1;
          hide.style.opacity=0;
          active=(active==='A')?'B':'A';
        });
      };

      if(typeof show.decode==='function'){
        show.decode().then(reveal).catch(reveal);
      }else{
        if(show.complete) reveal();
        else show.onload=reveal;
      }
    }

    // 핵심 렌더
    async function show(i){
      idx=(i+gallery.length)%gallery.length;
      const it=gallery[idx];

      lbCap.innerHTML=it.caption||'';
      lbCount.textContent=(idx+1)+'/'+gallery.length;

      if(it.type==='video'){
        setVisible(lbCanvas,false);
        setVisible(lbVideo,true);
        setAriaFor('video');

        const vid=vimeoIdFromUrl(it.src);
        try{
          if(!lbPlayer){
            lbPlayer=new Vimeo.Player(lbIframe,{
              id: vid || undefined,
              autoplay:true, muted:true, playsinline:true,
              byline:false, title:false, portrait:false
            });
          }else{
            await stopVideo();
            if(vid) await lbPlayer.loadVideo(vid);
          }
          try{ await lbPlayer.setMuted(true); }catch(e){}
          try{ await lbPlayer.setVolume(0); }catch(e){}
          try{ await lbPlayer.play(); }catch(e){
            const once=()=>{ lbPlayer.play().catch(()=>{}); overlay.removeEventListener('click', once); };
            overlay.addEventListener('click', once, {once:true});
          }
        }catch(e){
          lbIframe.src=it.src;
        }
      }else{
        await stopVideo();
        setVisible(lbVideo,false);
        setVisible(lbCanvas,true);
        setAriaFor('image');

        const alt=it.el.getAttribute('alt')||'';
        swapImage(it.src, alt);
        preloadNeighbors(idx);
      }

      // 현재 항목 자체 프리로드 힌트
      try{
        const cur=document.createElement('link');
        cur.rel='preload'; cur.as='image'; cur.href=it.src;
        document.head.appendChild(cur);
        setTimeout(()=>cur.remove(), 4000);
      }catch(e){}
    }

    // 열기/닫기
    function openLB(i){
      show(i);
      overlay.classList.add('open');
      document.body.style.overflow='hidden';
      open=true;

      if(!didPushState){
        history.pushState({lightbox:true},'',location.href);
        didPushState=true;
        window.addEventListener('popstate', onPopStateCloseLB);
      }
    }
    function closeLB(){
      overlay.classList.remove('open');
      document.body.style.overflow='';
      open=false;

      try{ lbIframe && lbIframe.blur && lbIframe.blur(); }catch(e){}
      stopVideo();

      if(didPushState){
        window.removeEventListener('popstate', onPopStateCloseLB);
        didPushState=false;
        setTimeout(()=>history.back(),0);
      }
    }
    function next(){ show(idx+1); }
    function prev(){ show(idx-1); }

    // 컨트롤
    lbClose.addEventListener('click', closeLB);
    lbNext.addEventListener('click', next);
    lbPrev.addEventListener('click', prev);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeLB(); });
    document.addEventListener('keydown', (e)=>{
      if(!open) return;
      if(e.key==='Escape') closeLB();
      else if(e.key==='ArrowRight') next();
      else if(e.key==='ArrowLeft') prev();
    });

    // 본문 비디오 iframe에도 playsinline 권장
    document.querySelectorAll('.intro-media figure.work.video iframe').forEach(f=>{
      if(!f.hasAttribute('playsinline')) f.setAttribute('playsinline','');
      const allow=f.getAttribute('allow')||'';
      if(!/autoplay/.test(allow)) f.setAttribute('allow', (allow?allow+', ':'')+'autoplay; fullscreen; picture-in-picture; encrypted-media');
    });
  })();
  </script>

</body>
</html>

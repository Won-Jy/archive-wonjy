---
layout: none
---

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>{{ page.title }} | archive-wonjy</title>
<style>
  :root { --blue:#007BFF; --border:#ddd; --text:#222; --muted:#666; }
  html,body{margin:0;padding:0;font-family:sans-serif;line-height:1.6;color:var(--text)}
  /* header (사이트 공통 스타일에 맞춰 최소치만) */
  header.site{display:flex;align-items:center;gap:40px;padding:20px 24px;border-bottom:1px solid var(--border)}
  .title{font-size:1.2em;text-transform:lowercase}
  nav.main a{margin-left:24px;text-decoration:none;color:#555;font-size:.95em}
  nav.main a:hover{color:var(--blue)}

  /* layout */
  main{display:grid;grid-template-columns:minmax(0,1fr) 320px;gap:24px;max-width:1200px;margin:24px auto;padding:0 24px}
  @media (max-width: 960px){ main{grid-template-columns:1fr} aside{position:static} }
  article .text-body{max-width:70ch}
  aside{position:sticky;top:24px;align-self:start}
  .section{border:1px solid var(--border);padding:14px 16px}
  .section + .section{margin-top:16px}
  h1,h2,h3,h4{font-weight:normal;margin:.2em 0 .4em}
  .meta{display:flex;align-items:center;gap:8px;margin:.25rem 0 .75rem;color:var(--muted);font-size:.95em}

  /* language tabs */
  .lang-tabs{display:flex;gap:8px;margin:.5rem 0 1rem}
  .lang-tabs button{
    border:1px solid var(--border);background:#fff;padding:4px 8px;font:inherit;cursor:pointer;
    color:#444
  }
  .lang-tabs button:hover{color:var(--blue)}
  .lang-tabs button.active{color:var(--blue);border-color:var(--blue)}
  .lang-tabs .orig-badge{margin-left:6px;font-size:.8em;color:var(--muted)}

  /* notes */
  .notes{margin-top:24px}
  .notes ol{margin:0;padding-left:20px}
  .notes li{margin:.4rem 0}
  .note-ref{cursor:pointer;text-decoration:none;color:inherit}
  .note-ref:hover{color:var(--blue)}
  .footnote-back{margin-left:6px;text-decoration:none;color:var(--muted)}
  .footnote-back:hover{color:var(--blue)}

  /* tooltip (주석 hover) */
  .tooltip{
    position:fixed;z-index:1000;max-width:360px;border:1px solid var(--border);background:#fff;
    padding:8px 10px;box-shadow:0 2px 10px rgba(0,0,0,.08);font-size:.95em;display:none
  }

  /* related buttons */
  .buttons{display:flex;flex-wrap:wrap;gap:8px}
  .buttons a{border:1px solid var(--border);padding:6px 10px;text-decoration:none;color:#444}
  .buttons a:hover{color:var(--blue);border-color:var(--blue)}

  /* divider */
  .divider{height:1px;background:var(--border);margin:24px 0}

  /* back to top */
  #backToTop{
    position:fixed;right:24px;bottom:24px;display:none;border:1px solid var(--border);
    background:#fff;padding:10px 14px;cursor:pointer
  }
  #backToTop:hover{color:var(--blue);border-color:var(--blue)}
</style>
</head>
<body>

<header class="site">
  <div class="title"><a href="/" style="text-decoration:none;color:inherit">archive-wonjy.com</a></div>
  <nav class="main">
    <a href="/index.html">Home</a>
    <a href="/work.html">Work</a>
    <a href="/bio.html">Bio</a>
    <a href="/texts.html" style="color:var(--blue)">Texts</a>
    <a href="/contact.html">Contact</a>
  </nav>
</header>

{% assign t = site.data.texts[page.text_id] %}

<main>
  <article>
    <h1 class="text-title">{{ t.title_original.text_html }}</h1>
    <div class="meta">
      <span>{{ t.author.name }}</span>
      <span>·</span>
      <span>{{ t.year }}</span>
    </div>

    <!-- language tabs -->
    <div class="lang-tabs" id="langTabs">
      <!-- 원문 버튼: 항상 맨 왼쪽 -->
      <button class="lang-btn" data-lang="{{ t.original.language | default: 'fr' }}">
        ({{ t.original.language | default: 'fr' | upcase }})<span class="orig-badge">orig.</span>
      </button>
      {% for tr in t.translations %}
        <button class="lang-btn" data-lang="{{ tr.language }}">({{ tr.language | upcase }})</button>
      {% endfor %}
    </div>

    <!-- 본문 영역: 모든 언어 DOM에 미리 렌더 → JS로 표시 전환 -->
    <div class="text-variants">
      <div class="text-body variant" data-lang="{{ t.original.language | default: 'fr' }}">
        {{ t.original.body_html }}
      </div>

      {% for tr in t.translations %}
        <div class="text-body variant" data-lang="{{ tr.language }}" style="display:none">
          {% if tr.title_html %}<h2 class="translated-title" style="margin-top:0">{{ tr.title_html }}</h2>{% endif %}
          <div class="translator" style="color:var(--muted);font-size:.95em;margin-bottom:.5rem">
            {% if tr.translator and tr.translator != "" %}translated by {{ tr.translator }} · {% endif %}{{ tr.year }}
          </div>
          {{ tr.body_html }}
        </div>
      {% endfor %}
    </div>

    <div class="divider"></div>

    <!-- 각주: 언어별로 전환 -->
    <section class="notes">
      <h3>각주내용</h3>

      <ol class="notes-variants">
        <li style="list-style:none;padding:0;margin:0">
          <ol class="notes-list variant" data-lang="{{ t.original.language | default: 'fr' }}">
            {% for n in t.original.notes %}
              <li id="fn-{{ n.id }}-{{ t.original.language | default: 'fr' }}">{{ n.html }} <a class="footnote-back" href="#fnref-{{ n.id }}-{{ t.original.language | default: 'fr' }}">↩</a></li>
            {% endfor %}
          </ol>
        </li>

        {% for tr in t.translations %}
        <li style="list-style:none;padding:0;margin:0">
          <ol class="notes-list variant" data-lang="{{ tr.language }}" style="display:none">
            {% for n in tr.notes %}
              <li id="fn-{{ n.id }}-{{ tr.language }}">{{ n.html }} <a class="footnote-back" href="#fnref-{{ n.id }}-{{ tr.language }}">↩</a></li>
            {% endfor %}
          </ol>
        </li>
        {% endfor %}
      </ol>
    </section>
  </article>

  <aside>
    <section class="section">
      <h4>관련 작업들</h4>
      <div class="buttons">
        {% for r in t.related_works %}
          <a href="/{{ r.slug }}.html">보기</a>
        {% endfor %}
      </div>
    </section>

    <section class="section">
      <h4>출처</h4>
      {{ t.source_html }}
    </section>

    <div class="divider"></div>

    <section class="section">
      <h4>저자 소개</h4>
      {{ t.author.bio_html }}
    </section>
  </aside>
</main>

<button id="backToTop" aria-label="Back to top">Back to top</button>

<!-- tooltip box -->
<div id="tooltip" class="tooltip"></div>

<script>
(function(){
  const qs = (s,el=document)=>el.querySelector(s);
  const qsa = (s,el=document)=>Array.from(el.querySelectorAll(s));

  const defaultLang = "{{ page.lang | default: t.original.language | default: 'fr' }}";
  const tabs = qsa('.lang-btn');
  const variants = qsa('.variant');
  const tooltip = qs('#tooltip');

  // 언어 표시 전환
  function setLang(lang){
    // buttons
    tabs.forEach(b=>{
      b.classList.toggle('active', b.dataset.lang===lang);
    });
    // blocks
    variants.forEach(v=>{
      v.style.display = (v.dataset.lang===lang) ? '' : 'none';
    });
    // URL ?lang= 유지
    const url = new URL(window.location);
    url.searchParams.set('lang', lang);
    window.history.replaceState({}, '', url);
    // 주석 링크/툴팁 초기화
    wireFootnotes(lang);
  }

  tabs.forEach(b=>{
    b.addEventListener('click', ()=> setLang(b.dataset.lang));
  });

  // 최초 언어 결정: ?lang=우선, 없으면 page/lang 또는 원문
  const urlLang = new URLSearchParams(window.location.search).get('lang') || defaultLang;
  setLang(urlLang);

  // 주석 상호작용
  function wireFootnotes(lang){
    // 1) 본문 내 sup(.note-ref)를 a 링크로 보강 + id 부여
    qsa('.text-body.variant[data-lang="'+lang+'"] sup.note-ref').forEach(sup=>{
      const num = (sup.textContent.match(/\d+/)||[])[0];
      if(!num) return;
      const refId = 'fnref-'+num+'-'+lang;
      const noteId = 'fn-'+num+'-'+lang;
      // a가 없으면 감싸기
      if(!sup.querySelector('a')){
        const a = document.createElement('a');
        a.href = '#'+noteId;
        a.textContent = sup.textContent;
        a.className = 'note-ref';
        sup.textContent = '';
        sup.id = refId;
        sup.appendChild(a);
      }else{
        sup.id = refId;
        sup.querySelector('a').classList.add('note-ref');
        sup.querySelector('a').setAttribute('href','#'+noteId);
      }
    });

    // 2) 툴팁: 본문 주석번호 hover 시 해당 각주 내용 보여주기
    const notesMap = {};
    qsa('.notes-list.variant[data-lang="'+lang+'"] li[id^="fn-"]').forEach(li=>{
      notesMap[li.id] = li.innerHTML.replace(/<a[^>]*class="footnote-back"[\s\S]*?<\/a>/,'').trim();
    });

    // 기존 이벤트 제거를 위해 새로 바인딩 전 먼저 모두 off 처리
    qsa('.note-ref').forEach(a=>{
      a.addEventListener('mouseenter', onEnter);
      a.addEventListener('mouseleave', onLeave);
      a.addEventListener('mousemove', onMove);
    });
    function onEnter(e){
      const href = this.getAttribute('href').substring(1); // fn-1-fr
      const html = notesMap[href];
      if(!html) return;
      tooltip.innerHTML = html;
      tooltip.style.display = 'block';
      onMove.call(this, e);
    }
    function onLeave(){
      tooltip.style.display = 'none';
      tooltip.innerHTML = '';
    }
    function onMove(e){
      const pad = 10;
      tooltip.style.left = (e.clientX + pad) + 'px';
      tooltip.style.top  = (e.clientY + pad) + 'px';
    }
  }

  // 최초 주석 결선
  wireFootnotes(urlLang);

  // back to top
  const btt = qs('#backToTop');
  window.addEventListener('scroll', ()=>{
    btt.style.display = window.scrollY > 400 ? 'block' : 'none';
  });
  btt.addEventListener('click', ()=>{
    window.scrollTo({top:0,behavior:'smooth'});
  });
})();
</script>

</body>
</html>

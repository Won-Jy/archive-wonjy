---
layout: none
title: Texts
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Texts | archive-wonjy.com</title>
  <meta name="description" content="Won Jy's personal archiving site.">
  <link rel="icon" href="/favicon.png" type="image/x-icon">

  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  
  <style>
    @media (max-width: 768px){
    :root{ --list-height: 400px; }
    header{ display:flex; flex-direction:column; align-items:flex-start; padding:16px 20px; border-bottom:1px solid #ddd; }
    header .title{ align-self:flex-start; }
    nav{ margin:12px 0 0 0; }
    nav a{ margin-left:30px; text-decoration:none; color:#555; font-size:1.05em; transition:color .2s; font-weight:normal; }
    nav a:first-child{ margin-left:0; }
    nav a:hover, nav a.active{ color:#007BFF; }

    main{ padding:60px 40px 60px 24px; max-width:700px; }
    main.list{ padding:40px 24px 30px 24px; max-width:700px; min-height:auto }
    main.detail{ padding:40px 40px 60px 24px; max-width:700px; }
    .text-link{ padding-left:0; padding-right:0; }

    main.list,
    #listView,
    #pager { border: 0 !important; }
    main.detail { border: 0 !important; }

    #detailView:not([hidden]) #detailArticle {
      border-bottom: 1px solid var(--border);
      padding-bottom: 24px;
      margin-bottom: 12px;
    }
    #detailView #detailAside {
      border-top: 0 !important;
      padding-top: 0;
      margin-top: 0;
    }

    .tooltip{
      position: absolute;       
      z-index: 9999;
      max-width: min(90vw, 320px);
      box-sizing: border-box;
      word-wrap: break-word;
      background: #fff;
      border: 1px solid #007BFF;
      padding: 6px 8px;
      border-radius: 0px;
      font-size: 0.85em;
      line-height: 1.3;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

  }

  @media (min-width: 769px){
    main{ padding:60px 40px; max-width:1200px; }
    main.list{ padding:50px 40px 10px 40px; max-width:740px; }
    main.detail{ padding:50px 40px 60px 40px; max-width:1200px; }
  }
  </style>
</head>
<body>
  <header>
    <a href="/index.html" class="title">archive-wonjy.com</a>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/work.html">Work</a>
      <a href="/bio.html">Bio</a>
      <a href="/texts.html" class="active">Texts</a>
      <a href="/contact.html">Contact</a>
    </nav>
  </header>

  <main class="list" id="listView" hidden>
    <div id="items" class="items"></div>
  </main>
  <div id="pager" class="pagination" hidden></div>

  <main class="detail" id="detailView" hidden>
    <article id="detailArticle"></article>
    <aside id="detailAside"></aside>
  </main>

  <a id="backToTop" href="#" aria-label="Back to top">Back to top</a>
  <div id="tooltip" class="tooltip" style="display:none"></div>

  <script>
    const DATA = {
      {% for pair in site.data.texts %}
        {% assign id = pair[0] %}{% assign t = pair[1] %}
        "{{ id }}": {{ t | jsonify }}{% unless forloop.last %},{% endunless %}
      {% endfor %}
     };

      const params = new URLSearchParams(location.search);
      const currentId = params.get('id');
      if (currentId && DATA[currentId]) { renderDetail(currentId); } else { renderList(); }

      function renderList(){
      document.getElementById('listView').hidden = false;
      document.getElementById('pager').hidden = false;

    const arr = Object.entries(DATA).map(([id,t])=>({
      id,
      title_html: t.title_original?.text_html || '',
      author: t.author?.name || '',
      year: t.year || '',
      date_written: t.date_written || ''
    }));

    arr.sort((a,b)=>{
      const da = new Date(a.date_written || a.year || 0);
      const db = new Date(b.date_written || b.year || 0);
      if (db.getTime() !== da.getTime()) return db - da; // 최신순
      return (a.title_html||'').localeCompare(b.title_html||'', undefined, {sensitivity:'base'});
    });

    function getPerPage(){ return window.innerWidth <= 768 ? 7 : 10; }
    let perPage = getPerPage();
    let page = 1;

    const itemsEl = document.getElementById('items');
    const pagerEl = document.getElementById('pager');

    function draw(){
      const start = (page-1)*perPage, end = start+perPage;
      itemsEl.innerHTML = '';
      arr.slice(start,end).forEach(it=>{
        const a = document.createElement('a');
        a.className = 'text-link';
        a.href = `?id=${encodeURIComponent(it.id)}`;
        a.innerHTML =
          `<span class="text-title">${it.title_html}</span>`+
          `<span class="meta-sep">,</span><span class="author">${it.author}</span>`+
          `<span class="meta-sep">,</span><span class="year">${it.year}</span>`;
        itemsEl.appendChild(a);
      });

      const total = Math.max(1, Math.ceil(arr.length/perPage));
      pagerEl.innerHTML = '';
      for(let i=1;i<=total;i++){
        if(i>1) pagerEl.appendChild(document.createTextNode(' / '));
        const link = document.createElement('a'); link.href='#'; link.textContent=i;
        if(i===page) link.classList.add('active');
        link.addEventListener('click', e=>{
          e.preventDefault(); page=i; draw(); window.scrollTo({top:0,behavior:'smooth'});
        });
        pagerEl.appendChild(link);
      }
    }
    draw();
    window.addEventListener('resize', ()=>{
      const newPerPage = getPerPage();
      if(newPerPage !== perPage){ perPage = newPerPage; page=1; draw(); }
    });
    }

    function renderDetail(id){
    const t = DATA[id];
    document.getElementById('detailView').hidden = false;
    const article = document.getElementById('detailArticle');
    const aside = document.getElementById('detailAside');
    const origLang = (t.original?.language || 'fr').toLowerCase();

    const notesCounts = {};
    notesCounts[origLang] = (t.original?.notes || []).length;
    (t.translations || []).forEach(tr => { notesCounts[tr.language] = (tr.notes || []).length; });
    const hasAnyNotes = Object.values(notesCounts).some(n => n > 0);

    article.innerHTML = `
      <h1 class="text-title">${t.title_original?.text_html || ''}</h1>
      <div class="meta"><span>${t.author?.name || ''}, ${t.year || ''}</span></div>

      <div class="lang-tabs" id="langTabs">
        <button class="lang-btn" data-lang="${origLang}">(${origLang.toUpperCase()})<span class="orig-badge">orig.</span></button>
        ${(t.translations||[]).map(tr=>`<button class="lang-btn" data-lang="${tr.language}">(${String(tr.language).toUpperCase()})</button>`).join('')}
      </div>

      <div class="text-variants">
        <div class="text-body variant" data-lang="${origLang}">
          ${t.original?.body_html || ''}
        </div>
        ${(t.translations||[]).map(tr=>`
          <div class="text-body variant" data-lang="${tr.language}" style="display:none">
            ${tr.body_html || ''}
          </div>
        `).join('')}
      </div>

      ${hasAnyNotes ? `
      <div id="notesDivider" class="divider"></div>
      <section id="notesSection" class="notes">
        <h3>Notes</h3>
        <ol class="notes-variants">
          <li style="list-style:none;padding:0;margin:0">
            <ol class="notes-list variant" data-lang="${origLang}">
              ${(t.original?.notes||[]).map(n=>`
                <li id="fn-${n.id}-${origLang}">
                  <a class="note-num" href="#fnref-${n.id}-${origLang}">[${n.id}]</a> ${n.html}
                </li>
              `).join('')}
            </ol>
          </li>
          ${(t.translations||[]).map(tr=>`
            <li style="list-style:none;padding:0;margin:0">
              <ol class="notes-list variant" data-lang="${tr.language}" style="display:none">
                ${(tr.notes||[]).map(n=>`
                  <li id="fn-${n.id}-${tr.language}">
                    <a class="note-num" href="#fnref-${n.id}-${tr.language}">[${n.id}]</a> ${n.html}
                  </li>
                `).join('')}
              </ol>
            </li>
          `).join('')}
        </ol>
      </section>
      ` : ``}
    `;

        // === ASIDE 채우기 (백업본 로직 이식) ===
    function isEmpty(val){
      if (val == null) return true;
      if (Array.isArray(val)) return val.length === 0;
      if (typeof val === 'string') return val.trim() === '';
      return false;
    }

    const asideBlocks = [];

    // Related works: [{ slug, label }]
    if (!isEmpty(t.related_works)) {
      asideBlocks.push(`
        <div class="aside-block">
          <h4>Related works</h4>
          <ul class="related-works">
            ${(t.related_works || []).map(r => {
              const label = r.label || 'View';
              return `<li><a href="/${r.slug}.html" class="link-button">${label}</a></li>`;
            }).join('')}
          </ul>
        </div>
      `);
    }

    // Source: source_html (string or array of strings with HTML)
    if (!isEmpty(t.source_html)) {
      const sourceHtml = Array.isArray(t.source_html) ? t.source_html.join('') : t.source_html;
      if (!isEmpty(sourceHtml)) {
        asideBlocks.push(`
          <div class="aside-block">
            <h4>Source</h4>
            ${sourceHtml}
          </div>
        `);
      }
    }

    // Author: author.bio_html
    asideBlocks.push(`
      <div class="aside-block">
        <h4>Author</h4>
        ${t.author?.bio_html || ''}
      </div>
    `);

    // 구분선으로 묶어서 주입
    aside.innerHTML = asideBlocks.filter(Boolean).join('<div class="divider"></div>');

    // 데스크톱: 새 탭 / 모바일: 같은 탭
    function applyAsideLinkTargets() {
      const isMobile = window.matchMedia('(max-width: 768px)').matches;
      aside.querySelectorAll('a').forEach(a => {
        if (isMobile) {
          a.removeAttribute('target');
          a.removeAttribute('rel');
        } else {
          a.setAttribute('target', '_blank');
          a.setAttribute('rel', 'noopener noreferrer');
        }
      });
    }
    applyAsideLinkTargets();
    window.addEventListener('resize', applyAsideLinkTargets);



      // === Tooltip anchoring ===
      let tipAnchor = null;

      function placeTooltipNear(el){
        const tooltip = document.getElementById('tooltip');
        const margin = 8;

        // 일단 화면 밖으로 보내고 크기 측정
        tooltip.style.left = '-9999px';
        tooltip.style.top  = '-9999px';

        const vw = document.documentElement.clientWidth;
        const vh = document.documentElement.clientHeight;
        const r  = el.getBoundingClientRect();
        const tr = tooltip.getBoundingClientRect();

        // 기본 배치: 앵커 아래 중앙
        let left = r.left + (r.width - tr.width)/2;
        let top  = r.bottom + margin;

        // 아래가 넘치면 위로 뒤집기
        if (top + tr.height + margin > vh) top = r.top - tr.height - margin;

        // 좌우 클램프
        if (left < margin) left = margin;
        if (left + tr.width + margin > vw) left = vw - tr.width - margin;

        // fixed(뷰포트 좌표) vs absolute(문서 좌표) 보정
        const isFixed = getComputedStyle(tooltip).position === 'fixed';
        const finalLeft = isFixed ? left : left + window.scrollX;
        const finalTop  = isFixed ? top  : top  + window.scrollY;

        tooltip.style.left = finalLeft + 'px';
        tooltip.style.top  = finalTop  + 'px';
      }

      function showTipNear(el, html){
        const tooltip = document.getElementById('tooltip');
        tipAnchor = el;
        tooltip.innerHTML = html;
        tooltip.style.display = 'block';
        // 한 프레임 뒤에 실제 위치로 배치(정확한 크기 측정을 위해)
        requestAnimationFrame(()=> placeTooltipNear(el));
      }

      function hideTip(){
        const tooltip = document.getElementById('tooltip');
        tooltip.style.display = 'none';
        tooltip.innerHTML = '';
        tipAnchor = null;
      }

      // 데스크톱(fixed)일 때는 스크롤 중에도 앵커를 따라오게
      window.addEventListener('scroll', ()=>{
        const tooltip = document.getElementById('tooltip');
        if (tooltip.style.display === 'none' || !tipAnchor) return;
        const isFixed = getComputedStyle(tooltip).position === 'fixed';
        if (!isFixed) return;           // 모바일(absolute)은 문서와 같이 움직여서 추가 처리 불필요
        const r = tipAnchor.getBoundingClientRect();
        // 앵커가 화면에서 벗어나면 닫기
        if (r.bottom < 0 || r.top > window.innerHeight) { hideTip(); return; }
        placeTooltipNear(tipAnchor);
      }, {passive:true});

      // 리사이즈/회전에선 재배치
      window.addEventListener('resize', ()=>{
        const tooltip = document.getElementById('tooltip');
        if (tooltip.style.display !== 'none' && tipAnchor) placeTooltipNear(tipAnchor);
      });





    function wireFootnotes(lang){
      article.querySelectorAll('.text-body.variant[data-lang="'+lang+'"] sup.note-ref').forEach(sup=>{
        const n = (sup.textContent.match(/\d+/)||[])[0]; if(!n) return;
        const refId = 'fnref-'+n+'-'+lang, noteId='fn-'+n+'-'+lang;
        if(!sup.querySelector('a')){
          const a=document.createElement('a'); a.href='#'+noteId; a.textContent=sup.textContent; a.className='note-ref';
          sup.textContent=''; sup.id=refId; sup.appendChild(a);
        }else{
          sup.id=refId; const a=sup.querySelector('a'); a.classList.add('note-ref'); a.setAttribute('href','#'+noteId);
        }
      });
      const notesMap = {};
      article.querySelectorAll('.notes-list.variant[data-lang="'+lang+'"] li[id^="fn-"]').forEach(li=>{
        const html = li.innerHTML.replace(/^\s*<a[^>]*class="note-num"[\s\S]*?<\/a>\s*/,'').trim();
        notesMap[li.id] = html;
      });
      // hover
      article.querySelectorAll('.note-ref').forEach(a=>{
        a.onmouseenter = function(){
          const href=this.getAttribute('href').slice(1);
          const html=notesMap[href]; if(!html) return;
          showTipNear(this, html);
        };
        a.onmouseleave = ()=>{ hideTip(); };
      });
      // 모바일 click
      article.querySelectorAll('.note-ref').forEach(a=>{
        a.addEventListener('click', function(e){
          const isMobile = window.matchMedia('(max-width: 768px)').matches;
          if(!isMobile) return;
          const href = this.getAttribute('href').slice(1);
          const html = notesMap[href]; if(!html) return;
          const alreadyPeeked = this.dataset.peek === '1';
          if(!alreadyPeeked){
            e.preventDefault();
            this.dataset.peek = '1';
            showTipNear(this, html);
            const clear=()=>{this.dataset.peek='0';hideTip();document.removeEventListener('click',outside,true);};
            const outside=(evt)=>{if(!this.contains(evt.target)) clear();};
            document.addEventListener('click',outside,true);
          }else{
            this.dataset.peek='0'; hideTip();
          }
        },{passive:false});
      });
    }

    const tabs = Array.from(article.querySelectorAll('.lang-btn'));
    const variants = Array.from(article.querySelectorAll('.variant'));

    function setLang(lang){
      tabs.forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
      variants.forEach(v=> v.style.display = (v.dataset.lang===lang) ? '' : 'none');
      const url = new URL(location); url.searchParams.set('id', id); url.searchParams.set('lang', lang); history.replaceState({}, '', url);
      wireFootnotes(lang);
      if (hasAnyNotes) {
        const notesDiv = article.querySelector('#notesDivider');
        const notesSec = article.querySelector('#notesSection');
        const hasThisLangNotes = (notesCounts[lang] || 0) > 0;
        [notesDiv, notesSec].forEach(el => { if (el) el.style.display = hasThisLangNotes ? '' : 'none'; });
        }
      hideTip();
    }
    tabs.forEach(b=> b.addEventListener('click', ()=> setLang(b.dataset.lang)));
    const initLang = new URLSearchParams(location.search).get('lang') || origLang;
    setLang(initLang);
    }

    const btt = document.getElementById('backToTop');
    window.addEventListener('scroll', ()=>{ btt.style.display = window.scrollY>300 ? 'block' : 'none'; });
    btt.addEventListener('click', (e)=>{
      e.preventDefault();
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce) window.scrollTo(0,0);
      else window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
